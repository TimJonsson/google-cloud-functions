name: Deploy Google Cloud Function test
on:
  push:
    branches:
      - deploy-github-action
jobs:
  Deploy:
    runs-on: 'ubuntu-latest'
    permissions:
     contents: 'read'
     id-token: 'write'
  
    steps:
    - uses: 'actions/checkout@v3'

    - id: 'auth'
      uses: 'google-github-actions/auth@v1'
      with:
        workload_identity_provider: ${{ secrets.WORKLOAD_IDENTITY_PROVIDER }}
        service_account: ${{ secrets.SERVICE_ACCOUNT_EMAIL }}
        
    - name: 'Set up Cloud SDK'
      uses: 'google-github-actions/setup-gcloud@v1'
      with:
        project_id: ${{ secrets.PROJECT_ID }} 
    
    - run: |
        pwd
        ls
        cd
        pwd
        ls

    - name: 'Use gcloud CLI'
      run: |
        'gcloud info'
    #     'gcloud functions deploy ${{ secrets.FUNCTION_NAME }} --gen2 --runtime=nodejs18 --region=europe-west4 --source=processSlackBotTaggedMessage --trigger-http --allow-unauthenticated --entry-point=processSlackBotTaggedMessage --memory=256MB --timeout=60'


    # - id: 'deploy'
    #   uses: 'google-github-actions/deploy-cloud-functions@v1'
    #   with:
    #     name: ${{ secrets.FUNCTION_NAME }}
    #     project_id: ${{ secrets.PROJECT_ID }}
    #     runtime: 'nodejs18'
    #     source_dir: 'processSlackBotTaggedMessage'
    #     ingress_settings: 'ALLOW_ALL'